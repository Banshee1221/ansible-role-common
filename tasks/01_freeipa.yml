---

- name: Install FreeIPA client packages
  apt:
    name: freeipa-client
    state: present

- name: Check if IPA joined
  stat:
    path: /etc/ipa/default.conf
  register: stat_result
  changed_when: False

- name: Join FreeIPA
  shell: ipa-client-install --hostname="{{ inventory_hostname }}" --domain="{{ freeipa_domain }}" --server="{{ freeipa_server_hostname }}" --realm="{{ freeipa_realm }}" -p "{{ freeipa_user }}" --password="{{ freeipa_pass }}" --force-join --unattended
  when: stat_result.stat.exists == False
